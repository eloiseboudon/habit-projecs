-- init_seed_habit.sql
-- Ins√®re les donn√©es de d√©marrage dans le sch√©ma habit

SET search_path TO habit, public;

-- DOMAINS
INSERT INTO domains (id, key, name, icon, order_index) VALUES
  (1, 'health',    'Sant√© & Sport',        'üí™', 1),
  (2, 'work',      'Travail & Projets',    'üíº', 2),
  (3, 'money',     'Finances',             'üí∞', 3),
  (4, 'mindset',   'Esprit & Connaissance','üß†', 4),
  (5, 'relations', 'Relations & Social',   'ü§ù', 5),
  (6, 'home',      'Maison & Vie perso',   'üè°', 6)
ON CONFLICT (id) DO NOTHING;

-- REWARDS
INSERT INTO rewards (id, title, cost_xp, is_active) VALUES
  (1, 'Badge Bronze', 100, true),
  (2, 'Badge Argent', 250, true),
  (3, 'Badge Or',     500, true)
ON CONFLICT (id) DO NOTHING;

-- TASK TEMPLATES
-- (corrig√© : virgule manquante apr√®s la 2e ligne + unit√©s coh√©rentes)
INSERT INTO task_templates (id, title, domain_id, default_xp, default_points, unit, is_active) VALUES
  (1,  'S√©ance de sport (45 min)',             1, 10, 10, 'min', true),
  (2,  'Boire 2L d‚Äôeau',                       1, 5,  5,  'L',   true),
  (3,  'Avancer un projet pro',                2, 10, 10, NULL,  true),
  (4,  'Apprendre une nouvelle comp√©tence',    2, 15, 15, NULL,  true),
  (5,  '√âpargner 20 ‚Ç¨',                        3, 10, 10, '‚Ç¨',   true),
  (6,  'Suivi budget perso',                   3, 5,  5,  NULL,  true),
  (7,  'Lecture 30 min',                       4, 10, 10, 'min', true),
  (8,  'M√©ditation 10 min',                    4, 5,  5,  'min', true),
  (9,  'Appeler un ami',                       5, 10, 10, NULL,  true),
  (10, 'Soir√©e en famille',                    5, 15, 15, NULL,  true),
  (11, 'Rangement 15 min',                     6, 5,  5,  'min', true),
  (12, 'Pr√©parer ses repas',                   6, 10, 10, NULL,  true)
ON CONFLICT (id) DO NOTHING;
-- SET search_path TO habit, public;

INSERT INTO task_templates (id, title, domain_id, default_xp, default_points, unit, is_active) VALUES
  -- Sant√© & Sport (1)
  (13, '10 000 pas',                          1, 10, 10, 'pas',     true),
  (14, 'Sommeil 7 h',                         1, 10, 10, 'h',       true),
  (15, '√âtirements 10 min',                   1, 5,  5,  'min',     true),
  (16, 'Yoga 20 min',                         1, 10, 10, 'min',     true),
  (17, 'Marche dehors 20 min',                1, 5,  5,  'min',     true),
  (18, 'Course 5 km',                         1, 15, 15, 'km',      true),
  (19, 'Pr√©parer le sac de sport',            1, 5,  5,  NULL,      true),
  (20, 'Journ√©e sans sucre ajout√©',           1, 10, 10, NULL,      true),
  (21, '5 portions fruits & l√©gumes',         1, 10, 10, 'portion', true),

  -- Travail & Projets (2)
  (22, 'Deep work 60 min',                    2, 15, 15, 'min',     true),
  (23, 'Planifier la journ√©e',                2, 5,  5,  NULL,      true),
  (24, 'Inbox z√©ro',                           2, 10, 10, NULL,      true),
  (25, '4 cycles Pomodoro',                   2, 10, 10, 'cycles',  true),
  (26, 'Revue objectifs du jour',             2, 5,  5,  NULL,      true),

  -- Finances (3)
  (27, 'Saisie des d√©penses du jour',         3, 5,  5,  NULL,      true),
  (28, 'Journ√©e sans d√©pense',                3, 10, 10, NULL,      true),
  (29, 'Mettre 10 ‚Ç¨ d‚Äô√©pargne',               3, 10, 10, '‚Ç¨',       true),
  (30, 'Revue budget 15 min',                 3, 5,  5,  'min',     true),

  -- Esprit & Connaissance (4)
  (31, 'Journal 5 min',                       4, 5,  5,  'min',     true),
  (32, 'Gratitude : 3 choses',                4, 5,  5,  NULL,      true),
  (33, 'Langue √©trang√®re 15 min',             4, 10, 10, 'min',     true),
  (34, 'Cours/formation 20 min',              4, 10, 10, 'min',     true),

  -- Relations & Social (5)
  (35, 'Message √† un proche',                 5, 5,  5,  NULL,      true),
  (36, 'Appeler un parent',                   5, 10, 10, NULL,      true),
  (37, 'D√©j / caf√© r√©seau',                   5, 10, 10, NULL,      true),
  (38, 'Remercier quelqu‚Äôun',                 5, 5,  5,  NULL,      true),

  -- Maison & Vie perso (6)
  (39, 'Faire la vaisselle',                  6, 5,  5,  NULL,      true),
  (40, 'Lancer une lessive',                  6, 5,  5,  NULL,      true),
  (41, 'Sortir les poubelles',                6, 5,  5,  NULL,      true),
  (42, 'Arroser les plantes',                 6, 5,  5,  NULL,      true),
  (43, 'Pr√©parer ses affaires pour demain',   6, 5,  5,  NULL,      true),
  (44, 'Nettoyer la cuisine 10 min',          6, 5,  5,  'min',     true),
  (45, 'Faire le lit',                        6, 5,  5,  NULL,      true)
ON CONFLICT (id) DO NOTHING;


-- (Optionnel) r√©alignement des s√©quences/identities sur le max(id)
-- Utile si tes colonnes id sont en GENERATED BY DEFAULT/ALWAYS AS IDENTITY
DO
$$
DECLARE
    rec RECORD;
    seq_name text;
    max_id bigint;
BEGIN
    FOR rec IN
        SELECT 'domains' AS tbl
        UNION ALL SELECT 'rewards'
        UNION ALL SELECT 'task_templates'
    LOOP
        -- R√©cup√©rer la s√©quence li√©e (fonctionne pour SERIAL/IDENTITY)
        SELECT pg_get_serial_sequence('habit.' || rec.tbl, 'id') INTO seq_name;
        IF seq_name IS NOT NULL THEN
            EXECUTE format('SELECT COALESCE(MAX(id), 0) FROM habit.%I', rec.tbl) INTO max_id;
            EXECUTE format('SELECT setval(%L, %s, true);', seq_name, max_id);
        END IF;
    END LOOP;
END
$$;
